; =========================
; Laravel queue workers (DATABASE driver)
; =========================
; Важно:
; - --sleep ставим 2-3, чтобы не долбить БД
; - max-time/max-jobs перезапускают воркер, чтобы не "закисал"
; - export лучше отдельным воркером с большим timeout
; =========================


[program:worker-getcourse]
priority=100
process_name=%(program_name)s_%(process_num)02d
command=php /var/www/html/artisan queue:work database --queue=getcourse_form,getcourse_order --sleep=2 --tries=3 --timeout=180 --max-time=3600 --max-jobs=800 --memory=256
autostart=true
autorestart=true
user=www-data
startsecs=5
stopwaitsecs=3600
stopasgroup=true
killasgroup=true
redirect_stderr=true
stdout_logfile=/var/www/html/storage/logs/queue-getcourse.log
stdout_logfile_maxbytes=20MB
stdout_logfile_backups=10
numprocs=1


[program:worker-bizon]
priority=100
process_name=%(program_name)s_%(process_num)02d
command=php /var/www/html/artisan queue:work database --queue=bizon_form,bizon_export --sleep=2 --tries=3 --timeout=180 --max-time=3600 --max-jobs=800 --memory=256
autostart=true
autorestart=true
user=www-data
startsecs=5
stopwaitsecs=3600
stopasgroup=true
killasgroup=true
redirect_stderr=true
stdout_logfile=/var/www/html/storage/logs/queue-bizon.log
stdout_logfile_maxbytes=20MB
stdout_logfile_backups=10
numprocs=1


[program:worker-tilda_form]
priority=100
process_name=%(program_name)s_%(process_num)02d
command=php /var/www/html/artisan queue:work database --queue=tilda_form --sleep=2 --tries=1 --timeout=120 --max-time=3600 --max-jobs=1200 --memory=256
autostart=true
autorestart=true
user=www-data
startsecs=5
stopwaitsecs=3600
stopasgroup=true
killasgroup=true
redirect_stderr=true
stdout_logfile=/var/www/html/storage/logs/queue-tilda.log
stdout_logfile_maxbytes=20MB
stdout_logfile_backups=10
numprocs=1


[program:alfacrm_hook]
priority=100
process_name=%(program_name)s_%(process_num)02d
command=php /var/www/html/artisan queue:work database --queue=alfacrm_hook --sleep=2 --tries=1 --timeout=180 --max-time=3600 --max-jobs=800 --memory=256
autostart=true
autorestart=true
user=www-data
startsecs=5
stopwaitsecs=3600
stopasgroup=true
killasgroup=true
redirect_stderr=true
stdout_logfile=/var/www/html/storage/logs/queue-alfacrm.log
stdout_logfile_maxbytes=20MB
stdout_logfile_backups=10
numprocs=1


[program:worker-distribution]
priority=100
process_name=%(program_name)s_%(process_num)02d
command=php /var/www/html/artisan queue:work database --queue=distribution_transaction --sleep=2 --tries=3 --timeout=180 --max-time=3600 --max-jobs=800 --memory=256
autostart=true
autorestart=true
user=www-data
startsecs=5
stopwaitsecs=3600
stopasgroup=true
killasgroup=true
redirect_stderr=true
stdout_logfile=/var/www/html/storage/logs/queue-distribution.log
stdout_logfile_maxbytes=20MB
stdout_logfile_backups=10
numprocs=1


[program:worker-yc]
priority=100
process_name=%(program_name)s_%(process_num)02d
command=php /var/www/html/artisan queue:work database --queue=yclients_record --sleep=2 --tries=3 --timeout=180 --max-time=3600 --max-jobs=800 --memory=256
autostart=true
autorestart=true
user=www-data
startsecs=5
stopwaitsecs=3600
stopasgroup=true
killasgroup=true
redirect_stderr=true
stdout_logfile=/var/www/html/storage/logs/queue-yclients.log
stdout_logfile_maxbytes=20MB
stdout_logfile_backups=10
numprocs=1

[program:import-excel]
priority=100
process_name=%(program_name)s_%(process_num)02d
command=php /var/www/html/artisan queue:work database --queue=import_excel --sleep=2 --tries=1 --timeout=180 --max-time=3600 --max-jobs=800 --memory=512
autostart=true
autorestart=true
user=www-data
startsecs=5
stopwaitsecs=3600
stopasgroup=true
killasgroup=true
redirect_stderr=true
stdout_logfile=/var/www/html/storage/logs/queue-excel.log
stdout_logfile_maxbytes=128MB
stdout_logfile_backups=10
numprocs=1


; default — самый "низкий приоритет"
[program:worker-default]
priority=200
process_name=%(program_name)s_%(process_num)02d
command=php /var/www/html/artisan queue:work database --sleep=3 --tries=3 --timeout=180 --max-time=3600 --max-jobs=1500 --memory=256
autostart=true
autorestart=true
user=www-data
startsecs=5
stopwaitsecs=3600
stopasgroup=true
killasgroup=true
redirect_stderr=true
stdout_logfile=/var/www/html/storage/logs/queue-default.log
stdout_logfile_maxbytes=20MB
stdout_logfile_backups=10
numprocs=1
